<!-- retriever-api/static/index.html -->
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Elastic Chatbot (RAG)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:900px;margin:24px auto;padding:0 16px}
    h1{margin:0 0 12px}
    .row{display:flex;gap:8px}
    textarea{flex:1;min-height:80px;padding:8px}
    button{padding:10px 16px;cursor:pointer}
    .chat{margin-top:16px;border:1px solid #ddd;border-radius:12px;padding:12px;min-height:200px}
    .msg{margin:10px 0;padding:10px;border-radius:10px}
    .user{background:#f1f5f9}
    .bot{background:#f8fafc}
    .sources{font-size:12px;color:#475569;margin-top:6px}
    .footer{margin-top:24px;color:#64748b;font-size:12px}
  </style>
</head>
<body>
  <h1>Elastic Chatbot (RAG)</h1>
  <div class="row">
    <textarea id="q" placeholder="Pergunte algo…"></textarea>
    <button id="ask">Perguntar</button>
  </div>

  <div class="chat" id="chat"></div>

  <div class="footer">
    <a href="/docs" target="_blank">Swagger</a> • <a href="/usage" target="_blank">/usage</a>
  </div>

<script>
const chat = document.getElementById('chat');
const q = document.getElementById('q');
document.getElementById('ask').onclick = async () => {
  const question = q.value.trim();
  if(!question) return;
  renderMsg('user', question);
  q.value = '';
  try {
    const res = await fetch('/api/ask', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ question, k: 4 })
    });
    const data = await res.json();
    renderMsg('bot', data.answer, data.sources);
  } catch(e) {
    renderMsg('bot', 'Erro ao consultar API: ' + e);
  }
};

function renderMsg(role, text, sources){
  const div = document.createElement('div');
  div.className = 'msg ' + (role==='user'?'user':'bot');
  div.innerHTML = '<div>'+escapeHTML(text).replace(/\\n/g,'<br/>')+'</div>';
  if(sources && sources.length){
    const s = document.createElement('div');
    s.className = 'sources';
    s.innerHTML = 'Fontes: ' + sources.map(x => {
      const t = x.title || 'sem título';
      const u = x.url || '#';
      return '<a href="'+u+'" target="_blank">'+escapeHTML(t)+'</a>';
    }).join(' • ');
    div.appendChild(s);
  }
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
function escapeHTML(str){return (str||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]))}
</script>
</body>
</html>
